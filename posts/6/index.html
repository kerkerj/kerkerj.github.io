
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>kerkerj</title>
  <meta name="author" content="kerkerj">

  
  <meta name="description" content="cool thing, cool guy">
  <meta name="keywords" content="mac,ubuntu,nginx,rails,ruby,php,mysql,freebsd,technique,geek">

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://kerkerj.github.io/posts/6">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="kerkerj" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->

<link href="/favicon.ico" rel="icon">
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='//fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<link href='//fonts.googleapis.com/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-45583907-2']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">kerkerj</a></h1>
  
    <h2>Cool</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
  
  
  
  
<ul class="subscription">
  <li><a href="https://github.com/kerkerj" rel="subscribe-github" title="@kerkerj on GitHub">GitHub</a></li>
</ul>
  
  
  
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:kerkerj.github.io" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/notes">Notes</a></li>
  <li><a href="/mac-app-list">Mac App List</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/08/05/capistrano-with-rails-basic-notes/">Capistrano With Rails - Basic Notes</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-08-05T22:36:48+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2014/08/05/capistrano-with-rails-basic-notes/#disqus_thread"
             data-disqus-identifier="http://kerkerj.github.io/blog/2014/08/05/capistrano-with-rails-basic-notes/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>詳細的東西還是看 project&rsquo;s github page 比較快 - <a href="https://github.com/capistrano/capistrano">Capistrano@github</a></p>

<p>Capistrano 剛開始寫 deploy script 時真的會有點搞不太懂 XD<br/>
記錄一下使用 &lsquo;capistrano&rsquo; 把特定的 github repo 抓到 remote server</p>

<h2>安裝</h2>

<p>先在 Gemfile 加入:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gem 'capistrano', '~&gt; 3.2.0'   </span></code></pre></td></tr></table></div></figure>


<p>
然後安裝~</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>bundle install</span></code></pre></td></tr></table></div></figure>


<p>步驟大概會是：</p>

<p>假設已經寫完 capistrano 了，執行 script 時，<br/>
capistrano 會先利用 script 裡提供的 server ip 以及 public key，<br/>
先連線到 remote server，接著再到 github 上拉 code 到指定的目錄裡，<br/>
再重開 server。</p>

<h2>產生相關檔案</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>bundle exec cap install </span></code></pre></td></tr></table></div></figure>


<p>會產生以下檔案:  (copy from <a href="https://github.com/capistrano/capistrano">Capistrano@github</a>)</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>├── Capfile
</span><span class='line'>├── config
</span><span class='line'>│   ├── deploy
</span><span class='line'>│   │   ├── production.rb
</span><span class='line'>│   │   └── staging.rb
</span><span class='line'>│   └── deploy.rb
</span><span class='line'>└── lib
</span><span class='line'>    └── capistrano
</span><span class='line'>            └── tasks</span></code></pre></td></tr></table></div></figure>


<p>deploy.rb 通常是設定 source control 的類型 (可以設定 git, hg, svn)， <br/>
project repo 的路徑，要 deploy 到 server 的哪個目錄等等，<br/>
<code>config/deploy/*</code> 底下的檔案則是根據不同的 stage 分別設定，<br/>
以下是 deploy.rb, production.rb 的一些簡單設定</p>

<figure class='code'><figcaption><span>deploy.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># config valid only for Capistrano 3.1</span>
</span><span class='line'><span class="n">lock</span> <span class="s1">&#39;3.2.1&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">set</span> <span class="ss">:application</span><span class="p">,</span> <span class="s1">&#39;application_name&#39;</span>
</span><span class='line'><span class="n">set</span> <span class="ss">:repo_url</span><span class="p">,</span> <span class="s1">&#39;github_repo_url&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="n">set</span> <span class="ss">:deploy_via</span><span class="p">,</span> <span class="ss">:copy</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Default branch is :master</span>
</span><span class='line'><span class="c1"># ask :branch, proc { `git rev-parse --abbrev-ref HEAD`.chomp }.call</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Default deploy_to directory is /var/www/my_app</span>
</span><span class='line'><span class="n">set</span> <span class="ss">:deploy_to</span><span class="p">,</span> <span class="s1">&#39;/server/www/path/&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Default value for :scm is :git</span>
</span><span class='line'><span class="n">set</span> <span class="ss">:scm</span><span class="p">,</span> <span class="ss">:git</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Default value for :format is :pretty</span>
</span><span class='line'><span class="n">set</span> <span class="ss">:format</span><span class="p">,</span> <span class="ss">:pretty</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Default value for :log_level is :debug</span>
</span><span class='line'><span class="n">set</span> <span class="ss">:log_level</span><span class="p">,</span> <span class="ss">:debug</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Default value for :pty is false</span>
</span><span class='line'><span class="c1"># set :pty, true</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Default value for :linked_files is []</span>
</span><span class='line'><span class="c1"># set :linked_files, %w{config/database.yml}</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Default value for linked_dirs is []</span>
</span><span class='line'><span class="c1"># set :linked_dirs, %w{bin log tmp/pids tmp/cache tmp/sockets vendor/bundle public/system}</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Default value for default_env is {}</span>
</span><span class='line'><span class="c1"># set :default_env, { path: &quot;/opt/ruby/bin:$PATH&quot; }</span>
</span><span class='line'>
</span><span class='line'><span class="c1"># Default value for keep_releases is 5</span>
</span><span class='line'><span class="c1"># set :keep_releases, 5</span>
</span><span class='line'>
</span><span class='line'><span class="n">namespace</span> <span class="ss">:deploy</span> <span class="k">do</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">desc</span> <span class="s1">&#39;Restart application&#39;</span>
</span><span class='line'>  <span class="n">task</span> <span class="ss">:restart</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">on</span> <span class="n">roles</span><span class="p">(</span><span class="ss">:app</span><span class="p">),</span> <span class="k">in</span><span class="p">:</span> <span class="ss">:sequence</span><span class="p">,</span> <span class="ss">wait</span><span class="p">:</span> <span class="mi">5</span> <span class="k">do</span>
</span><span class='line'>      <span class="c1"># Your restart mechanism here, for example:</span>
</span><span class='line'>      <span class="n">execute</span> <span class="ss">:mkdir</span><span class="p">,</span> <span class="s1">&#39;-p&#39;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">#{</span> <span class="n">release_path</span> <span class="si">}</span><span class="s2">/tmp&quot;</span>
</span><span class='line'>      <span class="n">execute</span> <span class="ss">:touch</span><span class="p">,</span> <span class="n">release_path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;tmp/restart.txt&#39;</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">after</span> <span class="ss">:publishing</span><span class="p">,</span> <span class="ss">:restart</span>
</span><span class='line'>
</span><span class='line'>  <span class="n">after</span> <span class="ss">:restart</span><span class="p">,</span> <span class="ss">:clear_cache</span> <span class="k">do</span>
</span><span class='line'>    <span class="n">on</span> <span class="n">roles</span><span class="p">(</span><span class="ss">:web</span><span class="p">),</span> <span class="k">in</span><span class="p">:</span> <span class="ss">:groups</span><span class="p">,</span> <span class="ss">limit</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="ss">wait</span><span class="p">:</span> <span class="mi">10</span> <span class="k">do</span>
</span><span class='line'>      <span class="c1"># Here we can do anything such as:</span>
</span><span class='line'>      <span class="c1"># within release_path do</span>
</span><span class='line'>      <span class="c1">#  execute :rake, &#39;cache:clear&#39;</span>
</span><span class='line'>      <span class="c1"># end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>  <span class="k">end</span>
</span><span class='line'>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>production.rb</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="c1"># Simple Role Syntax</span>
</span><span class='line'><span class="c1"># ==================</span>
</span><span class='line'><span class="c1"># Supports bulk-adding hosts to roles, the primary server in each group</span>
</span><span class='line'><span class="c1"># is considered to be the first unless any hosts have the primary</span>
</span><span class='line'><span class="c1"># property set.  Don&#39;t declare `role :all`, it&#39;s a meta role.</span>
</span><span class='line'>
</span><span class='line'><span class="n">role</span> <span class="ss">:app</span><span class="p">,</span> <span class="sx">%w{app@server}</span>
</span><span class='line'><span class="n">role</span> <span class="ss">:web</span><span class="p">,</span> <span class="sx">%w{web@server}</span>
</span><span class='line'><span class="n">role</span> <span class="ss">:db</span><span class="p">,</span>  <span class="sx">%w{db@server}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1"># Extended Server Syntax</span>
</span><span class='line'><span class="c1"># ======================</span>
</span><span class='line'><span class="c1"># This can be used to drop a more detailed server definition into the</span>
</span><span class='line'><span class="c1"># server list. The second argument is a, or duck-types, Hash and is</span>
</span><span class='line'><span class="c1"># used to set extended properties on the server.</span>
</span><span class='line'>
</span><span class='line'><span class="n">server</span> <span class="s1">&#39;server_ip&#39;</span><span class="p">,</span> <span class="ss">user</span><span class="p">:</span> <span class="s1">&#39;server_user&#39;</span><span class="p">,</span> <span class="ss">roles</span><span class="p">:</span> <span class="sx">%w{app}</span><span class="p">,</span> <span class="n">my_property</span><span class="p">:</span> <span class="ss">:my_value</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="c1"># Custom SSH Options</span>
</span><span class='line'><span class="c1"># ==================</span>
</span><span class='line'><span class="c1"># You may pass any option but keep in mind that net/ssh understands a</span>
</span><span class='line'><span class="c1"># limited set of options, consult[net/ssh documentation](http://net-ssh.github.io/net-ssh/classes/Net/SSH.html#method-c-start).</span>
</span><span class='line'><span class="c1">#</span>
</span><span class='line'><span class="c1"># Global options</span>
</span><span class='line'><span class="c1"># --------------</span>
</span><span class='line'><span class="c1">#  set :ssh_options, {</span>
</span><span class='line'><span class="c1">#    keys: %w(/home/rlisowski/.ssh/id_rsa),</span>
</span><span class='line'><span class="c1">#    forward_agent: true</span>
</span><span class='line'><span class="c1">#    auth_methods: %w(password)</span>
</span><span class='line'><span class="c1">#  }</span>
</span><span class='line'><span class="c1">#</span>
</span><span class='line'><span class="c1"># And/or per server (overrides global)</span>
</span><span class='line'><span class="c1"># ------------------------------------</span>
</span><span class='line'> <span class="n">server</span> <span class="s1">&#39;server_ip&#39;</span><span class="p">,</span>
</span><span class='line'>   <span class="ss">user</span><span class="p">:</span> <span class="s1">&#39;server_user&#39;</span><span class="p">,</span>
</span><span class='line'>   <span class="n">ssh_options</span><span class="p">:</span> <span class="p">{</span>
</span><span class='line'>     <span class="ss">keys</span><span class="p">:</span> <span class="sx">%w(/user/.ssh/id_rsa)</span><span class="p">,</span>
</span><span class='line'>     <span class="n">forward_agent</span><span class="p">:</span> <span class="kp">false</span><span class="p">,</span>
</span><span class='line'>     <span class="n">auth_methods</span><span class="p">:</span> <span class="sx">%w(publickey password)</span>
</span><span class='line'>   <span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>設定完後，因為這邊是設定 production.rb<br/>
因此執行以下指令 deploy 到 production server</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='console'><span class='line'><span class="go">bundle exec cap production deploy</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>如果 <code>exit status 0 (successful).</code> <br/>
那就是成功啦~</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/07/30/install-rails-server-env-with-rbenv-on-ubuntu-14-dot-04/">Install Rails Server Env With Rbenv on Ubuntu 14.04</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-07-30T11:36:54+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2014/07/30/install-rails-server-env-with-rbenv-on-ubuntu-14-dot-04/#disqus_thread"
             data-disqus-identifier="http://kerkerj.github.io/blog/2014/07/30/install-rails-server-env-with-rbenv-on-ubuntu-14-dot-04/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>nodejs v0.10.25 (for rails javascript engine)
</span><span class='line'>
</span><span class='line'>rbenv 0.4.0-98-g13a474c
</span><span class='line'>
</span><span class='line'>ruby 2.1.2p95 (2014-05-08 revision 45877) [x86_64-linux]
</span><span class='line'>
</span><span class='line'>Rails 4.1.4
</span><span class='line'>
</span><span class='line'>nginx version: nginx/1.6.0
</span><span class='line'>
</span><span class='line'>Phusion Passenger version 4.0.48
</span><span class='line'>
</span><span class='line'>mysql  Ver 14.14 Distrib 5.5.38, for debian-linux-gnu (x86_64) using readline 6.3
</span></code></pre></td></tr></table></div></figure>


<h2>Installing Ruby &amp; Rails</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo apt-get update && sudo apt-get upgrade
</span><span class='line'>sudo apt-get install git-core curl zlib1g-dev build-essential libssl-dev libreadline-dev libyaml-dev libsqlite3-dev sqlite3 libxml2-dev libxslt1-dev libcurl4-openssl-dev python-software-properties nodejs npm</span></code></pre></td></tr></table></div></figure>


<p>Use rbenv</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>cd
</span><span class='line'>git clone git://github.com/sstephenson/rbenv.git .rbenv
</span><span class='line'>echo 'export PATH="$HOME/.rbenv/bin:$PATH"' &gt;&gt; ~/.bashrc
</span><span class='line'>echo 'eval "$(rbenv init -)"' &gt;&gt; ~/.bashrc
</span><span class='line'>exec $SHELL
</span><span class='line'>
</span><span class='line'>git clone git://github.com/sstephenson/ruby-build.git ~/.rbenv/plugins/ruby-build
</span><span class='line'>echo 'export PATH="$HOME/.rbenv/plugins/ruby-build/bin:$PATH"' &gt;&gt; ~/.bashrc
</span><span class='line'>exec $SHELL
</span><span class='line'>
</span><span class='line'>rbenv install 2.1.2
</span><span class='line'>exec $SHELL
</span><span class='line'>
</span><span class='line'>rbenv global 2.1.2
</span><span class='line'>ruby -v</span></code></pre></td></tr></table></div></figure>


<p>Don&rsquo;t install rdoc when installing gems</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>echo "gem: --no-ri --no-rdoc" &gt; ~/.gemrc</span></code></pre></td></tr></table></div></figure>


<p>Install rails</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>gem install rails
</span><span class='line'>exec $SHELL
</span><span class='line'>rails -v</span></code></pre></td></tr></table></div></figure>


<h2>Installing Nginx with passenger</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class=''><span class='line'># Install Phusion's PGP key to verify packages
</span><span class='line'>gpg --keyserver keyserver.ubuntu.com --recv-keys 561F9B9CAC40B2F7
</span><span class='line'>gpg --armor --export 561F9B9CAC40B2F7 | sudo apt-key add -
</span><span class='line'>
</span><span class='line'># Add HTTPS support to APT
</span><span class='line'>sudo apt-get install apt-transport-https
</span><span class='line'>
</span><span class='line'># Add the passenger repository
</span><span class='line'>sudo sh -c "echo 'deb https://oss-binaries.phusionpassenger.com/apt/passenger trusty main' &gt;&gt; /etc/apt/sources.list.d/passenger.list"
</span><span class='line'>sudo chown root: /etc/apt/sources.list.d/passenger.list
</span><span class='line'>sudo chmod 600 /etc/apt/sources.list.d/passenger.list
</span><span class='line'>sudo apt-get update
</span><span class='line'>
</span><span class='line'># Install nginx and passenger
</span><span class='line'>sudo apt-get install nginx-full passenger</span></code></pre></td></tr></table></div></figure>


<p>Edit passenger configuration in <code>/etc/nginx/nginx.conf</code></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>##
</span><span class='line'># Phusion Passenger
</span><span class='line'>##
</span><span class='line'># Uncomment it if you installed ruby-passenger or ruby-passenger-enterprise
</span><span class='line'>##
</span><span class='line'>
</span><span class='line'>passenger_root /usr/lib/ruby/vendor_ruby/phusion_passenger/locations.ini;
</span><span class='line'>
</span><span class='line'>passenger_ruby /usr/bin/ruby; #change this line
</span><span class='line'>
</span><span class='line'># passenger_ruby /home/yourpath/.rbenv/shims/ruby; # If you use rbenv
</span><span class='line'># Use `which ruby`</span></code></pre></td></tr></table></div></figure>


<h2>Installing MySQL</h2>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo apt-get install mysql-server mysql-client libmysqlclient-dev</span></code></pre></td></tr></table></div></figure>


<p>Done!</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/07/03/rails-actioncontrollerinvalidauthenticitytoken-when-useing-rails-as-api/">[Rails] ActionController::InvalidAuthenticityToken When Useing Rails4 as API</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-07-03T04:02:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2014/07/03/rails-actioncontrollerinvalidauthenticitytoken-when-useing-rails-as-api/#disqus_thread"
             data-disqus-identifier="http://kerkerj.github.io/blog/2014/07/03/rails-actioncontrollerinvalidauthenticitytoken-when-useing-rails-as-api/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>change<br/>
<code>protect_from_forgery with: :exception</code><br/>
to<br/>
<code>protect_from_forgery with: :null_session</code><br/>
in <code>ApplicationController</code></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/06/19/apache-ssl/">[Apache] SSL (Self-signed & Purchased Version)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-06-19T02:32:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2014/06/19/apache-ssl/#disqus_thread"
             data-disqus-identifier="http://kerkerj.github.io/blog/2014/06/19/apache-ssl/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>[Self-signed]</h2>

<hr />

<ol>
<li>Generate a host key:</li>
</ol>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo ssh-keygen -f host.key</span></code></pre></td></tr></table></div></figure>


<ol>
<li>Generate a certificate request file</li>
</ol>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo openssl req -new -key host.key -out request.csr</span></code></pre></td></tr></table></div></figure>


<p>Type what you want:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>  Country Name (2 letter code) [AU]:TW
</span><span class='line'>  State or Province Name (full name) [Some-State]:Taiwan
</span><span class='line'>  Locality Name (eg, city) []:Taipei
</span><span class='line'>  Organization Name (eg, company) [Internet Widgits Pty Ltd]:
</span><span class='line'>  Organizational Unit Name (eg, section) []:
</span><span class='line'>  Common Name (e.g. server FQDN or YOUR name) []:
</span><span class='line'>  Email Address []:
</span><span class='line'>  
</span><span class='line'>  Please enter the following 'extra' attributes
</span><span class='line'>  to be sent with your certificate request
</span><span class='line'>  A challenge password []:
</span><span class='line'>  An optional company name []:</span></code></pre></td></tr></table></div></figure>


<ol>
<li><p>Create the SSL certificate
<code>sudo openssl x509 -req -days 365 -in request.csr -signkey host.key -out server.crt</code></p>

<p>  Create a nopass&#8217; key (optional)
  <code>openssl rsa -in host.key -out host.nopass.key</code></p></li>
<li><p>Configure Apache
<code>LoadModule ssl_module libexec/apache2/mod_ssl.so</code></p></li>
</ol>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>SSLEngine on 
</span><span class='line'>SSLCertificateFile "/etc/apache2/ssl/server.crt"
</span><span class='line'>SSLCertificateKeyFile "/etc/apache2/ssl/host.nopass.key"</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>sudo apachectl configtest 
</span><span class='line'>sudo apachectl restart </span></code></pre></td></tr></table></div></figure>


<p>p.s. enable mods: <code>sudo a2enmod ssl</code>
enable sites: <code>sudo a2ensite default-ssl</code></p>

<h2>[Purchased (Symantec)]</h2>

<hr />

<p>[<a href="http://www.symantec.com/tv/products/details.jsp?vid=1452855338001">http://www.symantec.com/tv/products/details.jsp?vid=1452855338001</a>]</p>

<object id="flashObj" width="640" height="360" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,47,0"><param name="movie" value="http://c.brightcove.com/services/viewer/federated_f9?isVid=1&isUI=1" /><param name="bgcolor" value="#FFFFFF" /><param name="flashVars" value="videoId=1452855338001&linkBaseURL=http%3A%2F%2Fwww.symantec.com%2Ftv%2Fproducts%2Fdetails.jsp%3Fvid%3D1452855338001&playerID=1170996384001&playerKey=AQ~~,AAAABuIiy9k~,I8BhasVwr9yry4vRRPOpsSrBvwjFZ03K&domain=embed&dynamicStreaming=true" /><param name="base" value="http://admin.brightcove.com" /><param name="seamlesstabbing" value="false" /><param name="allowFullScreen" value="true" /><param name="swLiveConnect" value="true" /><param name="allowScriptAccess" value="always" /><embed src="http://c.brightcove.com/services/viewer/federated_f9?isVid=1&isUI=1" bgcolor="#FFFFFF" flashVars="videoId=1452855338001&linkBaseURL=http%3A%2F%2Fwww.symantec.com%2Ftv%2Fproducts%2Fdetails.jsp%3Fvid%3D1452855338001&playerID=1170996384001&playerKey=AQ~~,AAAABuIiy9k~,I8BhasVwr9yry4vRRPOpsSrBvwjFZ03K&domain=embed&dynamicStreaming=true" base="http://admin.brightcove.com" name="flashObj" width="640" height="360" seamlesstabbing="false" type="application/x-shockwave-flash" allowFullScreen="true" allowScriptAccess="always" swLiveConnect="true" pluginspage="http://www.macromedia.com/shockwave/download/index.cgi?P1_Prod_Version=ShockwaveFlash"></embed></object>




<object id="flashObj" width="640" height="360" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" codebase="http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,47,0"><param name="movie" value="http://c.brightcove.com/services/viewer/federated_f9?isVid=1&isUI=1" /><param name="bgcolor" value="#FFFFFF" /><param name="flashVars" value="videoId=1452855338001&linkBaseURL=http%3A%2F%2Fwww.symantec.com%2Ftv%2Fproducts%2Fdetails.jsp%3Fvid%3D1452855338001&playerID=1170996384001&playerKey=AQ~~,AAAABuIiy9k~,I8BhasVwr9yry4vRRPOpsSrBvwjFZ03K&domain=embed&dynamicStreaming=true" /><param name="base" value="http://admin.brightcove.com" /><param name="seamlesstabbing" value="false" /><param name="allowFullScreen" value="true" /><param name="swLiveConnect" value="true" /><param name="allowScriptAccess" value="always" /><embed src="http://c.brightcove.com/services/viewer/federated_f9?isVid=1&isUI=1" bgcolor="#FFFFFF" flashVars="videoId=1452855338001&linkBaseURL=http%3A%2F%2Fwww.symantec.com%2Ftv%2Fproducts%2Fdetails.jsp%3Fvid%3D1452855338001&playerID=1170996384001&playerKey=AQ~~,AAAABuIiy9k~,I8BhasVwr9yry4vRRPOpsSrBvwjFZ03K&domain=embed&dynamicStreaming=true" base="http://admin.brightcove.com" name="flashObj" width="640" height="360" seamlesstabbing="false" type="application/x-shockwave-flash" allowFullScreen="true" allowScriptAccess="always" swLiveConnect="true" pluginspage="http://www.macromedia.com/shockwave/download/index.cgi?P1_Prod_Version=ShockwaveFlash"></embed></object>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/06/16/mac-update-openssl-on-mac/">[Mac] Update Openssl on Mac</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-06-16T09:16:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2014/06/16/mac-update-openssl-on-mac/#disqus_thread"
             data-disqus-identifier="http://kerkerj.github.io/blog/2014/06/16/mac-update-openssl-on-mac/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>First of all, you need &lsquo;brew&rsquo; (<a href="http://brew.sh/">http://brew.sh/</a>)</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ brew update
</span><span class='line'>$ brew install openssl
</span><span class='line'>$ brew link --force openssl
</span><span class='line'> 
</span><span class='line'>$openssl version -a</span></code></pre></td></tr></table></div></figure>


<p>If it&rsquo;s still the old version, you shoud:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo rm /usr/bin/openssl   #remove the old binary 
</span><span class='line'>$ sudo ln -s /usr/local/Cellar/openssl/1.0.1h/bin/openssl /usr/local/bin
</span><span class='line'>(1.0.1h -&gt; the latest version)</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>ref: <a href="http://apple.stackexchange.com/questions/126830/how-to-upgrade-openssl-in-os-x">http://apple.stackexchange.com/questions/126830/how-to-upgrade-openssl-in-os-x</a></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/06/11/mysql-add-a-unique-index-by-2-columns/">[MySQL] Add a Unique Index by 2 Columns</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-06-11T08:51:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2014/06/11/mysql-add-a-unique-index-by-2-columns/#disqus_thread"
             data-disqus-identifier="http://kerkerj.github.io/blog/2014/06/11/mysql-add-a-unique-index-by-2-columns/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><code>ALTER TABLE table_name ADD UNIQUE INDEX(column1, column2);</code></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/05/30/ubuntu-enable-disable-services-on-start-up/">[Ubuntu] Enable/disable Services on Start-up</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-05-30T03:56:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2014/05/30/ubuntu-enable-disable-services-on-start-up/#disqus_thread"
             data-disqus-identifier="http://kerkerj.github.io/blog/2014/05/30/ubuntu-enable-disable-services-on-start-up/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Take apache for example:</p>

<p>Disable - <code>update-rc.d -f apache2 remove</code></p>

<p>Enable - <code>update-rc.d apache2 defaults</code></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/05/28/codeigniter-tips-deploy-to-amazon-web-services/">[Codeigniter] Tips Deploy to Amazon Web Services</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-05-28T06:36:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2014/05/28/codeigniter-tips-deploy-to-amazon-web-services/#disqus_thread"
             data-disqus-identifier="http://kerkerj.github.io/blog/2014/05/28/codeigniter-tips-deploy-to-amazon-web-services/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><ol>
<li>If you use Amazon RDS, especially micro plan,<br/>
 remember to set <code>$config['pconnect'] = FALSE</code> in <code>application/config/database.php</code>.<br/>
 Because RDS has Max_connection limits.</li>
<li>If you use RDS, remeber that the system timezone in RDS is +0 timezone.<br/>
 In your application, you should care about this thing.</li>
<li>If you will use loadbalancer, remember to &hellip;.(???)</li>
</ol>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/05/06/mysql-several-useful-statements-group-concat-ifnull-date-format/">[MySQL] Several Useful Statements (GROUP_CONCAT, Ifnull, DATE_FORMAT)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-05-06T06:10:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2014/05/06/mysql-several-useful-statements-group-concat-ifnull-date-format/#disqus_thread"
             data-disqus-identifier="http://kerkerj.github.io/blog/2014/05/06/mysql-several-useful-statements-group-concat-ifnull-date-format/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><ol>
<li><p>將 query 出來的多筆記錄結合成一個欄位<br/>
例如原本的 query 結果為：<br/>
<code>SELECT 'fruits' FROM 'fruits_table'</code><br/>
apple<br/>
banana<br/>
kiwi<br/>
<code>SELECT group_concat('fruits' separator ',') FROM 'fruits_table'</code><br/>
result: apple,banana,kiwi</p></li>
<li><p>改變 datetime 欄位的顯示結果<br/>
<code>SELECT DATE_FORMAT( 'created_at', '%Y/%m/%d %H:%i') AS 'created_at' FROM 'message_table'</code><br/>
result: 2014/05/06 18:20</p></li>
<li><p>若某個欄位的值為空，則給予預設值<br/>
<code>SELECT ifnull('is_success', 0) AS 'is_success' FROM ....</code></p></li>
</ol>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2014/04/16/ubuntu-update-openssl/">[Ubuntu] Update OpenSSL</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2014-04-16T11:39:00+08:00" pubdate data-updated="true"></time>
        
           | <a href="/blog/2014/04/16/ubuntu-update-openssl/#disqus_thread"
             data-disqus-identifier="http://kerkerj.github.io/blog/2014/04/16/ubuntu-update-openssl/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Easy way:</p>

<ul>
<li>Below the single command line to compiling and install the last openssl version.</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ curl https://www.openssl.org/source/openssl-1.0.1h.tar.gz | tar xz && cd openssl-1.0.1h && sudo ./config && sudo make && sudo make install</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Replace old openssl binary file by the new one via a symlink.</li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ sudo ln -sf /usr/local/ssl/bin/openssl `which openssl`</span></code></pre></td></tr></table></div></figure>


<p>how to check version:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ openssl version -b
</span><span class='line'>built on: Mon Apr  7 20:33:29 UTC 2014
</span><span class='line'>$ openssl version -a
</span><span class='line'>OpenSSL 1.0.1 14 Mar 2012
</span><span class='line'>built on: Mon Apr  7 20:33:29 UTC 2014
</span><span class='line'>platform: debian-amd64
</span><span class='line'>options:  bn(64,64) rc4(16x,int) des(idx,cisc,16,int) blowfish(idx)
</span><span class='line'>compiler: ..........
</span><span class='line'>OPENSSLDIR: "/usr/lib/ssl"</span></code></pre></td></tr></table></div></figure>


<p>from: <a href="http://superuser.com/questions/740930/apt-get-upgrade-openssl-wont-bring-ubuntu-12-04-to-latest-version">http://superuser.com/questions/740930/apt-get-upgrade-openssl-wont-bring-ubuntu-12-04-to-latest-version</a></p>

<p>Hard way:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="c">#!/bin/bash</span>
</span><span class='line'>
</span><span class='line'><span class="c">###</span>
</span><span class='line'><span class="c"># Need to upgrade an Ubuntu 13.04 server to use OpenSSL 1.0.1g?</span>
</span><span class='line'><span class="c"># Read and execute this script :D</span>
</span><span class='line'><span class="c">###</span>
</span><span class='line'><span class="c"># License: WTFPL, GPLv3, MIT, whatever; just patch your shit</span>
</span><span class='line'><span class="c"># http://askubuntu.com/questions/444702/how-to-patch-cve-2014-0160-in-openssl</span>
</span><span class='line'><span class="c">###</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="o">[[</span> <span class="nv">$EUID</span> -ne 0 <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
</span><span class='line'><span class="k">  </span><span class="nb">echo</span> <span class="s2">&quot;This script must be run as root&quot;</span> 1&gt;<span class="p">&amp;</span>2
</span><span class='line'>  <span class="nb">exit </span>1
</span><span class='line'><span class="k">fi</span>
</span><span class='line'>wget https://www.openssl.org/source/openssl-1.0.1g.tar.gz
</span><span class='line'>wget https://www.openssl.org/source/openssl-1.0.1g.tar.gz.asc
</span><span class='line'>
</span><span class='line'>gpg --recv-key 0xD3577507FA40E9E2
</span><span class='line'><span class="c"># Dr Stephen Henson</span>
</span><span class='line'><span class="c"># IMPORTANT! Manually verify that this is the correct key ID:</span>
</span><span class='line'><span class="c"># http://pgp.mit.edu:11371/pks/lookup?op=vindex&amp;search=0xD3577507FA40E9E2</span>
</span><span class='line'><span class="c"># https://www.openssl.org/about/</span>
</span><span class='line'>
</span><span class='line'>gpg --verify openssl-1.0.1g.tar.gz.asc openssl-1.0.1g.tar.gz
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="o">[[</span> <span class="nv">$?</span> -eq 0 <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
</span><span class='line'><span class="k">  </span>tar xzvf openssl-1.0.1g.tar.gz
</span><span class='line'>  <span class="nb">cd </span>openssl-1.0.1g <span class="o">&amp;&amp;</span> sudo ./config <span class="o">&amp;&amp;</span> sudo make <span class="o">&amp;&amp;</span> sudo make install
</span><span class='line'>  <span class="c"># To link the old openssl library to a new version</span>
</span><span class='line'>  sudo ln -sf /usr/local/ssl/bin/openssl <span class="sb">`</span>which openssl<span class="sb">`</span>
</span><span class='line'>  <span class="nb">echo</span>
</span><span class='line'><span class="nb"> echo</span> <span class="s2">&quot;DONE!&quot;</span>
</span><span class='line'><span class="k">fi</span>
</span><span class='line'>
</span><span class='line'><span class="c"># eof</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/7">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/5">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    
  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2014 - kerkerj -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a> | Themed with <a href="https://github.com/lucaslew/whitespace">Whitespace</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'kerkerj-github';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>






<div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) {return;}
  js = d.createElement(s); js.id = id; js.async = true;
  js.src = "//connect.facebook.net/en_US/all.js#appId=212934732101925&xfbml=1";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>





  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
